<!DOCTYPE html>
<html>
<head>
  <title>Receptor de Áudio</title>
</head>
<body>
  <h1>Receptor</h1>
  <audio id="audioPlayer" autoplay controls></audio>
  <div id="status"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const roomId = 'transmission-room';
    let peerConnection;

    socket.emit('join-room', roomId);

    const configuration = {
      iceServers: [
        { urls: 'stun:stun.l.google.com:19302' }
      ]
    };

    socket.on('offer', async (offer) => {
      try {
        peerConnection = new RTCPeerConnection(configuration);

        peerConnection.ontrack = (event) => {
          const audioPlayer = document.getElementById('audioPlayer');
          audioPlayer.srcObject = event.streams[0];
        };

        peerConnection.onicecandidate = (event) => {
          if (event.candidate) {
            socket.emit('ice-candidate', event.candidate, roomId);
          }
        };

        await peerConnection.setRemoteDescription(offer);
        const answer = await peerConnection.createAnswer();
        await peerConnection.setLocalDescription(answer);
        socket.emit('answer', answer, roomId);
        
        document.getElementById('status').textContent = 'Conectado ao transmissor';
      } catch (error) {
        console.error('Erro ao processar oferta:', error);
        document.getElementById('status').textContent = 'Erro na conexão';
      }
    });

    socket.on('ice-candidate', async (candidate) => {
      try {
        await peerConnection.addIceCandidate(candidate);
      } catch (error) {
        console.error('Erro ao adicionar candidato ICE:', error);
      }
    });
  </script>
</body>
</html>